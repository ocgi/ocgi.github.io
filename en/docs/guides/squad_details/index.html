<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Squad Introduction</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=generator content="Hugo 0.83.1"><link rel=stylesheet href=https://ocgi.github.io/plugins/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://ocgi.github.io/plugins/themify-icons/themify-icons.css><link rel=icon href=https://ocgi.github.io/images/favicon.png type=image/x-icon><link href="https://fonts.googleapis.com/css?family=Lato:300,400,700&display=swap" rel=stylesheet><style>:root{--primary-color:#0052d9;--body-color:#f9f9f9;--text-color:#636363;--text-color-dark:#242738;--white-color:#ffffff;--light-color:#f8f9fa;--font-family:Lato}</style><link href=https://ocgi.github.io/css/style.min.css rel=stylesheet media=screen><script src=https://ocgi.github.io/plugins/jquery/jquery-1.12.4.js></script><script src=https://ocgi.github.io/plugins/jquery/jquery-ui.js></script><script src=https://ocgi.github.io/plugins/bootstrap/bootstrap.min.js></script><script src=https://ocgi.github.io/plugins/match-height/jquery.matchHeight-min.js></script></head><body><header class="shadow-bottom sticky-top bg-white"><nav class="navbar navbar-expand-md navbar-light"><div class=container><a class="navbar-brand px-2" href=/>OCGI</a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation aria-controls=navigation aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav ml-auto"><li class=nav-item><a class="nav-link text-dark" href=https://ocgi.github.io/en/docs/>Docs</a></li><li class=nav-item><a class="nav-link text-dark" href=https://github.com/ocgi>Github</a></li></ul><select class="lang-list dark" id=select-language onchange="location=this.value"><option id=en value=https://ocgi.github.io/en/docs/guides/squad_details/ selected>En</option></select></div></div></nav></header><section class="single section-sm pb-0"><div class=container><div class=row><div class=col-lg-3><div class=sidebar><ul class=list-styled><a class=back-btn href=/></a><li data-nav-id=https://ocgi.github.io/en/ title=Ens class=sidelist><a href=https://ocgi.github.io/en/>Ens</a><ul><li data-nav-id=https://ocgi.github.io/en/docs/ title="OCGI Documentation" class=sidelist><a href=https://ocgi.github.io/en/docs/>OCGI Documentation</a><ul><li data-nav-id=https://ocgi.github.io/en/docs/overview/ title=Overview class=sidelist><a href=https://ocgi.github.io/en/docs/overview/>Overview</a></li><li data-nav-id=https://ocgi.github.io/en/docs/installation/ title=Installation class=sidelist><a href=https://ocgi.github.io/en/docs/installation/>Installation</a></li><li data-nav-id=https://ocgi.github.io/en/docs/getting-started/ title="Getting Started" class=sidelist><a href=https://ocgi.github.io/en/docs/getting-started/>Getting Started</a><ul><li data-nav-id=https://ocgi.github.io/en/docs/getting-started/gameserver/ title="Create a GameServer" class=sidelist><a href=https://ocgi.github.io/en/docs/getting-started/gameserver/>Create a GameServer</a></li><li data-nav-id=https://ocgi.github.io/en/docs/getting-started/squad/ title="Create a Squad" class=sidelist><a href=https://ocgi.github.io/en/docs/getting-started/squad/>Create a Squad</a></li><li data-nav-id=https://ocgi.github.io/en/docs/getting-started/gpa/ title="Create a GeneralPodAutoscaler" class=sidelist><a href=https://ocgi.github.io/en/docs/getting-started/gpa/>Create a GeneralPodAutoscaler</a></li></ul></li><li data-nav-id=https://ocgi.github.io/en/docs/guides/ title=Guides class=sidelist><a href=https://ocgi.github.io/en/docs/guides/>Guides</a><ul><li data-nav-id=https://ocgi.github.io/en/docs/guides/squad_details/ title="Squad Introduction" class="sidelist
active"><a href=https://ocgi.github.io/en/docs/guides/squad_details/>Squad Introduction</a></li><li data-nav-id=https://ocgi.github.io/en/docs/guides/gpa/ title="GeneralPodAutoscaler Introduction" class=sidelist><a href=https://ocgi.github.io/en/docs/guides/gpa/>GeneralPodAutoscaler Introduction</a></li><li data-nav-id=https://ocgi.github.io/en/docs/guides/autoscaling_flow/ title="GameServer autoscaling workflow" class=sidelist><a href=https://ocgi.github.io/en/docs/guides/autoscaling_flow/>GameServer autoscaling workflow</a></li><li data-nav-id=https://ocgi.github.io/en/docs/guides/squad-scaledown-priority/ title="GamerServer scaling down priority" class=sidelist><a href=https://ocgi.github.io/en/docs/guides/squad-scaledown-priority/>GamerServer scaling down priority</a></li></ul></li><li data-nav-id=https://ocgi.github.io/en/docs/reference/ title=Reference class=sidelist><a href=https://ocgi.github.io/en/docs/reference/>Reference</a><ul><li data-nav-id=https://ocgi.github.io/en/docs/reference/sdk/ title="Carrier SDK" class=sidelist><a href=https://ocgi.github.io/en/docs/reference/sdk/>Carrier SDK</a></li><li data-nav-id=https://ocgi.github.io/en/docs/reference/gpa_webhook/ title="GPA Webhook example" class=sidelist><a href=https://ocgi.github.io/en/docs/reference/gpa_webhook/>GPA Webhook example</a></li></ul></li><li data-nav-id=https://ocgi.github.io/en/docs/examples/ title=Examples class=sidelist><a href=https://ocgi.github.io/en/docs/examples/>Examples</a></li><li data-nav-id=https://ocgi.github.io/en/docs/faq/ title="Frequently Asked Questions" class=sidelist><a href=https://ocgi.github.io/en/docs/faq/>Frequently Asked Questions</a></li></ul></li></ul></li></ul></div></div><div class=col-lg-9><div class="p-lg-5 p-4 bg-white"><h1 class=mb-5>Squad Introduction</h1><div class=content><h2 id=squad>Squad</h2><p>A <code>Squad</code> controller provides declarative update management capabilities for GameServers and GameServerSets. The user can describe the target state in Squad (such as the number of replicas), and the Squad controller will change the actual state according to certain rules, and finally make it reach the desired state.</p><h2 id=main-feature>main feature</h2><ul><li>Manage a group of GameServer</li><li>Support rolling update</li><li>Support batch (gray) update</li><li>Support in-place update</li><li>Support GameServer auto-scaling</li></ul><h2 id=squad-update-strategy>Squad update strategy</h2><p>Squad specifies the strategy for updating GameServer through <code>.spec.strategy</code>. <code>.spec.strategy.type</code> can be <code>Recreate</code>, <code>RollingUpdate</code> , <code>CanaryUpdate</code> or <code>InplaceUpdate</code>, the default is <code>RollingUpdate</code>.</p><h3 id=recreate-strategy>Recreate strategy</h3><p>Before creating GameServer, all existing GameServer will be deleted.</p><h2 id=rollingupdate-strategy>RollingUpdate strategy</h2><p>When specifying <code>.spec.strategy.type</code> as <code>RollingUpdate</code>, you can also specify <code>maxUnavailable</code> and <code>maxSurge</code> to control the rolling update process.</p><ul><li><p>maxUnavailable</p><p>The maximum number of unavailable GameServers. It is an optional field to specify the upper limit of the number of GameServers that are not available during the update process. The value can be an absolute number (for example, 5) or a percentage of the desired GameServer (for example, 10%). The percentage value is converted to an absolute number and the decimal part is removed. If <code>.spec.strategy.rollingUpdate.maxSurge</code> is 0, this value cannot be 0. The default value is 25%.</p></li><li><p>maxSurge</p><p>The maximum number of GameServer creations. It is an optional field to specify the number of GameServers that can be created beyond the expected number of GameServers. This value can be an absolute number (for example, 5) or a percentage of the desired GameServer (for example, 10%). If <code>MaxUnavailable</code> is 0, this value cannot be 0. The percentage value is converted to an absolute number by rounding up. The default value for this field is 25%.</p><p>For example: when this value is 25%, after starting the rolling update, the new GameServerSet will be expanded immediately, while ensuring that the total number of old and new GameServers does not exceed 125% of the total number of required GameServers. Once the old GameServer is killed, the new GameServerSet can be further expanded, while ensuring that the total number of GameServers running at any time during the update period is at most 125% of the total number of GameServers required.</p></li></ul><p>Example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>carrier.ocgi.dev/v1alpha1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Squad</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>squad5</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
  <span style=color:#f92672>scheduling</span>: <span style=color:#ae81ff>MostAllocated</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>matchLabels</span>:
      <span style=color:#f92672>carrier.ocgi.dev/squad</span>: <span style=color:#ae81ff>squad5</span>
  <span style=color:#f92672>strategy</span>:
    <span style=color:#f92672>rollingUpdate</span>:
      <span style=color:#f92672>maxSurge</span>: <span style=color:#ae81ff>25</span><span style=color:#ae81ff>%</span>
      <span style=color:#f92672>maxUnavailable</span>: <span style=color:#ae81ff>25</span><span style=color:#ae81ff>%</span>
    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>RollingUpdate</span>
...
</code></pre></div><h3 id=canaryupdate-strategy>CanaryUpdate strategy</h3><p>Batch gray-scale update strategy, under the <code>CanaryUpdate</code> strategy, you can also specify <code>type</code> and <code>threshold</code> to control the gray-scale process.</p><ul><li>type: GameServer update rules during the grayscale process, including &ldquo;deleteFirst&rdquo;, &ldquo;createFirst&rdquo; or &ldquo;inplace&rdquo;<ul><li>deleteFirst: When creating a new GameServer, delete the old GameServer first</li><li>createFirst: Create a new GameServer first, and delete the old GameServer only after the new GameServer is Ready</li></ul></li><li>threshold: The threshold of the gray level, used to control the number of GameServers in each batch of gray levels. It can be an absolute number (for example, 5) or a percentage of all GameServers (for example, 10%)</li></ul><p>Example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>carrier.ocgi.dev/v1alpha1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Squad</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>squad5</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
  <span style=color:#f92672>scheduling</span>: <span style=color:#ae81ff>MostAllocated</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>matchLabels</span>:
      <span style=color:#f92672>carrier.ocgi.dev/squad</span>: <span style=color:#ae81ff>squad5</span>
  <span style=color:#f92672>strategy</span>:
    <span style=color:#f92672>canaryUpdate</span>:
      <span style=color:#f92672>tpye</span>: <span style=color:#ae81ff>createFirst</span>
      <span style=color:#f92672>threshold</span>: <span style=color:#ae81ff>10</span><span style=color:#ae81ff>%</span>
    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>CanaryUpdate</span>
...
</code></pre></div><h3 id=inplaceupdate-strategy>InplaceUpdate strategy</h3><p>In-place update strategy, update the container in the way of Update GameServer instead of rebuilding the entire GameServer, you can keep the IP of GameServer unchanged, and at the same time the content (such as shared memory) of GameServer can be maintained. Threshold is used to control the number of updated replicas during the update process.</p><ul><li><p>threshold: The threshold of the gray level, used to control the number of GameServers in each batch of gray levels. It can be an absolute number (for example, 5) or a percentage of all GameServers (for example, 10%)</p><blockquote><p>It is necessary to manually adjust the <code>threshold</code> value when updating. After all the replicas are updated, the <code>threshold</code> will be reset to 0 to prevent misoperation during the update of the lower layer.</p></blockquote></li></ul><p>Example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>carrier.ocgi.dev/v1alpha1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Squad</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>squad5</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
  <span style=color:#f92672>scheduling</span>: <span style=color:#ae81ff>MostAllocated</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>matchLabels</span>:
      <span style=color:#f92672>carrier.ocgi.dev/squad</span>: <span style=color:#ae81ff>squad5</span>
  <span style=color:#f92672>strategy</span>:
    <span style=color:#f92672>inplaceUpdate</span>:
      <span style=color:#f92672>threshold</span>: <span style=color:#ae81ff>1</span>
    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>InplaceUpdate</span>
...
</code></pre></div></div><p class="post-meta border-bottom pb-3 mb-0 mt-3">Updated on 2020-11-24</p></p><nav class="pagination mt-3"><a class="nav nav-prev" href=https://ocgi.github.io/en/docs/guides/><i class="ti-arrow-left mr-2"></i> <span class="d-none d-md-block">Guides</span></a>
<a class="nav nav-next" href=https://ocgi.github.io/en/docs/guides/gpa/><span class="d-none d-md-block">GeneralPodAutoscaler Introduction</span><i class="ti-arrow-right ml-2"></i></a></nav></div></div></div></div></section><footer class="section pb-4"><div class=container><div class="row align-items-center"><div class="col-md-8 text-md-left text-center"><p class="mb-md-0 mb-4">Copyright Â© 2021 The OCGI Authors</p></div><div class="col-md-4 text-md-right text-center"><ul class=list-inline></ul></div></div></div></footer><script src=https://ocgi.github.io/js/script.min.js></script></body></html>