<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Create a Squad</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=generator content="Hugo 0.83.1"><link rel=stylesheet href=https://ocgi.github.io/plugins/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://ocgi.github.io/plugins/themify-icons/themify-icons.css><link rel=icon href=https://ocgi.github.io/images/favicon.png type=image/x-icon><link href="https://fonts.googleapis.com/css?family=Lato:300,400,700&display=swap" rel=stylesheet><style>:root{--primary-color:#0052d9;--body-color:#f9f9f9;--text-color:#636363;--text-color-dark:#242738;--white-color:#ffffff;--light-color:#f8f9fa;--font-family:Lato}</style><link href=https://ocgi.github.io/css/style.min.css rel=stylesheet media=screen><script src=https://ocgi.github.io/plugins/jquery/jquery-1.12.4.js></script><script src=https://ocgi.github.io/plugins/jquery/jquery-ui.js></script><script src=https://ocgi.github.io/plugins/bootstrap/bootstrap.min.js></script><script src=https://ocgi.github.io/plugins/match-height/jquery.matchHeight-min.js></script></head><body><header class="shadow-bottom sticky-top bg-white"><nav class="navbar navbar-expand-md navbar-light"><div class=container><a class="navbar-brand px-2" href=/>OCGI</a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation aria-controls=navigation aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav ml-auto"><li class=nav-item><a class="nav-link text-dark" href=https://ocgi.github.io/en/docs/>Docs</a></li><li class=nav-item><a class="nav-link text-dark" href=https://github.com/ocgi>Github</a></li></ul><select class="lang-list dark" id=select-language onchange="location=this.value"><option id=en value=https://ocgi.github.io/en/docs/getting-started/squad/ selected>En</option></select></div></div></nav></header><section class="single section-sm pb-0"><div class=container><div class=row><div class=col-lg-3><div class=sidebar><ul class=list-styled><a class=back-btn href=/></a><li data-nav-id=https://ocgi.github.io/en/ title=Ens class=sidelist><a href=https://ocgi.github.io/en/>Ens</a><ul><li data-nav-id=https://ocgi.github.io/en/docs/ title="OCGI Documentation" class=sidelist><a href=https://ocgi.github.io/en/docs/>OCGI Documentation</a><ul><li data-nav-id=https://ocgi.github.io/en/docs/overview/ title=Overview class=sidelist><a href=https://ocgi.github.io/en/docs/overview/>Overview</a></li><li data-nav-id=https://ocgi.github.io/en/docs/installation/ title=Installation class=sidelist><a href=https://ocgi.github.io/en/docs/installation/>Installation</a></li><li data-nav-id=https://ocgi.github.io/en/docs/getting-started/ title="Getting Started" class=sidelist><a href=https://ocgi.github.io/en/docs/getting-started/>Getting Started</a><ul><li data-nav-id=https://ocgi.github.io/en/docs/getting-started/gameserver/ title="Create a GameServer" class=sidelist><a href=https://ocgi.github.io/en/docs/getting-started/gameserver/>Create a GameServer</a></li><li data-nav-id=https://ocgi.github.io/en/docs/getting-started/squad/ title="Create a Squad" class="sidelist
active"><a href=https://ocgi.github.io/en/docs/getting-started/squad/>Create a Squad</a></li><li data-nav-id=https://ocgi.github.io/en/docs/getting-started/gpa/ title="Create a GeneralPodAutoscaler" class=sidelist><a href=https://ocgi.github.io/en/docs/getting-started/gpa/>Create a GeneralPodAutoscaler</a></li></ul></li><li data-nav-id=https://ocgi.github.io/en/docs/guides/ title=Guides class=sidelist><a href=https://ocgi.github.io/en/docs/guides/>Guides</a><ul><li data-nav-id=https://ocgi.github.io/en/docs/guides/squad_details/ title="Squad Introduction" class=sidelist><a href=https://ocgi.github.io/en/docs/guides/squad_details/>Squad Introduction</a></li><li data-nav-id=https://ocgi.github.io/en/docs/guides/gpa/ title="GeneralPodAutoscaler Introduction" class=sidelist><a href=https://ocgi.github.io/en/docs/guides/gpa/>GeneralPodAutoscaler Introduction</a></li><li data-nav-id=https://ocgi.github.io/en/docs/guides/autoscaling_flow/ title="GameServer autoscaling workflow" class=sidelist><a href=https://ocgi.github.io/en/docs/guides/autoscaling_flow/>GameServer autoscaling workflow</a></li><li data-nav-id=https://ocgi.github.io/en/docs/guides/squad-scaledown-priority/ title="GamerServer scaling down priority" class=sidelist><a href=https://ocgi.github.io/en/docs/guides/squad-scaledown-priority/>GamerServer scaling down priority</a></li></ul></li><li data-nav-id=https://ocgi.github.io/en/docs/reference/ title=Reference class=sidelist><a href=https://ocgi.github.io/en/docs/reference/>Reference</a><ul><li data-nav-id=https://ocgi.github.io/en/docs/reference/sdk/ title="Carrier SDK" class=sidelist><a href=https://ocgi.github.io/en/docs/reference/sdk/>Carrier SDK</a></li><li data-nav-id=https://ocgi.github.io/en/docs/reference/gpa_webhook/ title="GPA Webhook example" class=sidelist><a href=https://ocgi.github.io/en/docs/reference/gpa_webhook/>GPA Webhook example</a></li></ul></li><li data-nav-id=https://ocgi.github.io/en/docs/examples/ title=Examples class=sidelist><a href=https://ocgi.github.io/en/docs/examples/>Examples</a></li><li data-nav-id=https://ocgi.github.io/en/docs/faq/ title="Frequently Asked Questions" class=sidelist><a href=https://ocgi.github.io/en/docs/faq/>Frequently Asked Questions</a></li></ul></li></ul></li></ul></div></div><div class=col-lg-9><div class="p-lg-5 p-4 bg-white"><h1 class=mb-5>Create a Squad</h1><div class=content><p><code>Squad</code> represents a group of game servers (<code>GameServer</code>), they have the same resource configuration,
and the Carrier controller maintains the specified number of copies of the group of GameServer.
It controls the update and scaling of this group of GameServer.</p><h2 id=create-a-squad>Create a Squad</h2><p>Create a Squad with 2 replicas:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>cat <span style=color:#e6db74>&lt;&lt;EOF | kubectl apply -f -
</span><span style=color:#e6db74>apiVersion: carrier.ocgi.dev/v1alpha1
</span><span style=color:#e6db74>kind: Squad
</span><span style=color:#e6db74>metadata:
</span><span style=color:#e6db74>  name: squad-example
</span><span style=color:#e6db74>  namespace: default
</span><span style=color:#e6db74>spec:
</span><span style=color:#e6db74>  replicas: 2
</span><span style=color:#e6db74>  strategy:
</span><span style=color:#e6db74>    rollingUpdate:
</span><span style=color:#e6db74>      maxSurge: 1
</span><span style=color:#e6db74>      maxUnavailable: 1
</span><span style=color:#e6db74>    type: RollingUpdate
</span><span style=color:#e6db74>  template:
</span><span style=color:#e6db74>    metadata:
</span><span style=color:#e6db74>      labels:
</span><span style=color:#e6db74>        foo: bar
</span><span style=color:#e6db74>    spec:
</span><span style=color:#e6db74>      ports:
</span><span style=color:#e6db74>      - container: server
</span><span style=color:#e6db74>        containerPort: 7654
</span><span style=color:#e6db74>        name: default
</span><span style=color:#e6db74>        protocol: TCP
</span><span style=color:#e6db74>      sdkServer:
</span><span style=color:#e6db74>        grpcPort: 9020
</span><span style=color:#e6db74>        httpPort: 9021
</span><span style=color:#e6db74>        logLevel: Info
</span><span style=color:#e6db74>      template:
</span><span style=color:#e6db74>        spec:
</span><span style=color:#e6db74>          containers:
</span><span style=color:#e6db74>          - image: ocgi/simple-tcp:0.1
</span><span style=color:#e6db74>            name: server
</span><span style=color:#e6db74>EOF</span>
</code></pre></div><ul><li>Fetch the Squad status</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># kubectl get sqd</span>
NAME            SCHEDULING      DESIRED   CURRENT   UP-TO-DATE   READY   AGE
squad-example   MostAllocated   <span style=color:#ae81ff>2</span>         <span style=color:#ae81ff>2</span>         <span style=color:#ae81ff>2</span>            <span style=color:#ae81ff>2</span>       4s
</code></pre></div><p>Each field of GameServer represents:</p><ul><li>NAME describes the name of the Squad in the cluster</li><li>SCHEDULING scheduling strategy. The default is <code>MostAllocated</code>, support <code>MostAllocated</code>, <code>LeastAllocated</code><ul><li>MostAllocated: Applicable to dynamic clusters, InterPodAffinity will be injected to make Pod dispatch to one machine as much as possible to ensure the packing rate, and at the same time, the GameServer that has the least impact when shrinking;</li><li>LeastAllocated: Native scheduling strategy, scheduling to nodes with less resource usage, more GameServers will be affected when the cluster is scaled.</li></ul></li><li>DESIRED The number of replicas expected, consistent with the description of <code>.spec.replicas</code></li><li>CURRENT current number of copies</li><li>UP-TO-DATE shows the number of copies that have been updated in order to reach the desired status</li><li>READY The number of copies that are ready</li><li>AGE shows the running time of the application</li></ul><p>View GameServer and Pod information:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># kubectl get gs</span>
NAME                             STATE     ADDRESS      PORT   PORTRANGE   NODE             AGE
squad-example-75ddb545d9-cqgph   Running   172.16.5.9                      172.16.212.247   21s
squad-example-75ddb545d9-nzvkx   Running   172.16.5.8                      172.16.212.247   21s

<span style=color:#75715e># kubectl get pods</span>
NAME                             READY   STATUS    RESTARTS   AGE
squad-example-75ddb545d9-cqgph   2/2     Running   <span style=color:#ae81ff>0</span>          42s
squad-example-75ddb545d9-nzvkx   2/2     Running   <span style=color:#ae81ff>0</span>          42s
</code></pre></div><ul><li>Access the GameServer</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># telnet 172.16.5.8 7654</span>
Trying 172.16.5.8...
Connected to 172.16.5.8.
Escape character is <span style=color:#e6db74>&#39;^]&#39;</span>.
VERSION
Version: 0.1
</code></pre></div><h2 id=scale-the-squad>Scale the Squad</h2><ul><li>Scale up</li></ul><p>Scale up the number of replicas of <code>squad-example</code> from 2 to 4:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># kubectl scale sqd squad-example --replicas=4</span>
squad.carrier.ocgi.dev/squad-example scaled

<span style=color:#75715e># kubectl get gs</span>
NAME                             STATE     ADDRESS      PORT   PORTRANGE   NODE             AGE
squad-example-75ddb545d9-66k6p   Running   172.16.5.1                      172.16.212.247   8s
squad-example-75ddb545d9-cqgph   Running   172.16.5.9                      172.16.212.247   90m
squad-example-75ddb545d9-fm228   Running   172.16.5.0                      172.16.212.247   8s
squad-example-75ddb545d9-nzvkx   Running   172.16.5.8                      172.16.212.247   90m

<span style=color:#75715e># kubectl get pods</span>
NAME                             READY   STATUS    RESTARTS   AGE
squad-example-75ddb545d9-66k6p   2/2     Running   <span style=color:#ae81ff>0</span>          16s
squad-example-75ddb545d9-cqgph   2/2     Running   <span style=color:#ae81ff>0</span>          90m
squad-example-75ddb545d9-fm228   2/2     Running   <span style=color:#ae81ff>0</span>          16s
squad-example-75ddb545d9-nzvkx   2/2     Running   <span style=color:#ae81ff>0</span>          90m
</code></pre></div><ul><li>Scale down</li></ul><p>Scale down the number of replicas of <code>squad-example</code> from 4 to 3:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># kubectl scale sqd squad-example --replicas=3</span>
squad.carrier.ocgi.dev/squad-example scaled

<span style=color:#75715e># kubectl get gs  </span>
NAME                             STATE     ADDRESS      PORT   PORTRANGE   NODE             AGE
squad-example-75ddb545d9-66k6p   Running   172.16.5.1                      172.16.212.247   2m22s
squad-example-75ddb545d9-fm228   Running   172.16.5.0                      172.16.212.247   2m22s
squad-example-75ddb545d9-nzvkx   Running   172.16.5.8                      172.16.212.247   92m

<span style=color:#75715e># kubectl get pods</span>
NAME                             READY   STATUS    RESTARTS   AGE
squad-example-75ddb545d9-66k6p   2/2     Running   <span style=color:#ae81ff>0</span>          2m37s
squad-example-75ddb545d9-fm228   2/2     Running   <span style=color:#ae81ff>0</span>          2m37s
squad-example-75ddb545d9-nzvkx   2/2     Running   <span style=color:#ae81ff>0</span>          92m
</code></pre></div><h2 id=update-the-squad>Update the Squad</h2><p>Update the <code>squad-example</code> image to <code>ocgi/simple-tcp:0.2</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># kubectl patch squad squad-example --type=&#39;json&#39; -p=&#39;[{&#34;op&#34;: &#34;replace&#34;, &#34;path&#34;: &#34;/spec/template/spec/template/spec/containers/0/image&#34;, &#34;value&#34;:&#34;ocgi/simple-tcp:0.2&#34;}]&#39;</span>
<span style=color:#75715e># kubectl get gs  </span>
NAME                             STATE     ADDRESS      PORT   PORTRANGE   NODE             AGE
squad-example-5df4fb94c6-75565   Running   172.16.5.4                      172.16.212.247   34s
squad-example-5df4fb94c6-lzb92   Running   172.16.5.2                      172.16.212.247   43s
squad-example-5df4fb94c6-sjv9f   Running   172.16.5.3                      172.16.212.247   43s

<span style=color:#75715e># telnet 172.16.5.2 7654</span>
Trying 172.16.5.2...
Connected to 172.16.5.2.
Escape character is <span style=color:#e6db74>&#39;^]&#39;</span>.
VERSION
Version: 0.2
</code></pre></div><p>As we can see, the image of <code>squad-example</code> has been updated to <code>ocgi/simple-tcp:0.2</code>.</p><h2 id=rollback-update>Rollback update</h2><p>Sometimes after we complete the update, we find that there is a BUG or unstable online, and we want to roll back to the previous version, then we can achieve it through the Squad rollback function.
A certain number of versions (10 by default) are saved in Squad so that the specified version can be rolled back at any time.</p><p>For example, we found a BUG after updating to <code>ocgi/simple-tcp:0.2</code>, and hope to roll back to the previous version <code>ocgi/simple-tcp:0.1</code>, we can execute it.
The revision is set to 0, which means to roll back to the latest version.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># kubectl patch squad squad-example --type=&#39;json&#39; -p=&#39;[{&#34;op&#34;: &#34;add&#34;, &#34;path&#34;: &#34;/spec/rollbackTo&#34;, &#34;value&#34;: {&#34;revision&#34;: 0}}]&#39;</span>
</code></pre></div><p>Check the <code>squad-example</code> image:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># kubectl get sqd squad-example -o  jsonpath=&#34;{..image}&#34;</span>
ocgi/simple-tcp:0.1

<span style=color:#75715e># kubectl get gs  </span>
NAME                             STATE     ADDRESS      PORT   PORTRANGE   NODE             AGE
squad-example-75ddb545d9-6n7jh   Running   172.16.5.6                      172.16.212.247   24s
squad-example-75ddb545d9-l4dpc   Running   172.16.5.7                      172.16.212.247   19s
squad-example-75ddb545d9-lflnv   Running   172.16.5.5                      172.16.212.247   24s

<span style=color:#75715e># telnet 172.16.5.5 7654</span>
Trying 172.16.5.5...
Connected to 172.16.5.5.
Escape character is <span style=color:#e6db74>&#39;^]&#39;</span>.
VERSION
Version: 0.1
</code></pre></div><p>As we can see, the image has been rollbacked to <code>ocgi/simple-tcp:0.1</code>.</p><h2 id=reference>Reference</h2><p>For more information, please refer to the <a href=/en/docs/guides/squad_details>Squad introduction</a>.</p></div><p class="post-meta border-bottom pb-3 mb-0 mt-3">Updated on 2021-06-04</p></p><nav class="pagination mt-3"><a class="nav nav-prev" href=https://ocgi.github.io/en/docs/getting-started/gameserver/><i class="ti-arrow-left mr-2"></i> <span class="d-none d-md-block">Create a GameServer</span></a>
<a class="nav nav-next" href=https://ocgi.github.io/en/docs/getting-started/gpa/><span class="d-none d-md-block">Create a GeneralPodAutoscaler</span><i class="ti-arrow-right ml-2"></i></a></nav></div></div></div></div></section><footer class="section pb-4"><div class=container><div class="row align-items-center"><div class="col-md-8 text-md-left text-center"><p class="mb-md-0 mb-4">Copyright Â© 2021 The OCGI Authors</p></div><div class="col-md-4 text-md-right text-center"><ul class=list-inline></ul></div></div></div></footer><script src=https://ocgi.github.io/js/script.min.js></script></body></html>